DROP TABLE producto CASCADE CONSTRAINTS;
DROP TABLE venta CASCADE CONSTRAINTS;
DROP TABLE venta_detalle CASCADE CONSTRAINTS;

CREATE TABLE producto (
    id_producto     NUMBER(8) GENERATED ALWAYS AS IDENTITY
                          MAXVALUE 99999999
                          INCREMENT BY 1 
                          START WITH 1,
    nombre          VARCHAR2(100) NOT NULL,
    descripcion     VARCHAR2(200) NOT NULL,
    purchase_price   NUMBER(8) NOT NULL,
    quantity        NUMBER(4) NOT NULL
);

ALTER TABLE producto ADD CONSTRAINT producto_pk PRIMARY KEY ( id_producto );

CREATE TABLE venta (
    id_venta        NUMBER(8) GENERATED ALWAYS AS IDENTITY
                          MAXVALUE 99999999
                          INCREMENT BY 1 
                          START WITH 1,
    id_producto     NUMBER(8) NOT NULL,
    sell_price       NUMBER(8) NOT NULL,
    sell_date    DATE NOT NULL
);

ALTER TABLE venta ADD CONSTRAINT venta_pk PRIMARY KEY ( id_venta );

CREATE TABLE venta_detalle (
    id_venta_detalle        NUMBER(8) GENERATED ALWAYS AS IDENTITY
                          MAXVALUE 99999999
                          INCREMENT BY 1 
                          START WITH 1,
    id_producto     NUMBER(8) NOT NULL,
    sell_price      NUMBER(8) NOT NULL,
    periodo         VARCHAR2(50) NOT NULL,
    calc_date       DATE NOT NULL,
    income          NUMBER(8,3) NOT NULL,
    earning         NUMBER(8,3) NOT NULL
);

ALTER TABLE venta_detalle ADD CONSTRAINT venta_detalle_pk PRIMARY KEY ( id_venta_detalle );
    
ALTER TABLE venta
  ADD CONSTRAINT venta_producto_fk FOREIGN KEY ( id_producto )
    REFERENCES producto ( id_producto );

ALTER TABLE venta_detalle
  ADD CONSTRAINT venta_detalle_producto_fk FOREIGN KEY ( id_producto )
    REFERENCES producto ( id_producto );

INSERT INTO producto VALUES (DEFAULT, 'plato verde', 'plato plastico color verde', 2000, 100);
INSERT INTO venta VALUES (DEFAULT, 1, 3000, TO_TIMESTAMP('2023-12-15 15:35:00','YYYY-MM-DD HH24:MI:SS'));
INSERT INTO venta VALUES (DEFAULT, 1, 3000, TO_TIMESTAMP('2023-12-15 15:16:20','YYYY-MM-DD HH24:MI:SS'));
INSERT INTO venta VALUES (DEFAULT, 1, 4000, TO_TIMESTAMP('2024-02-12 15:40:00','YYYY-MM-DD HH24:MI:SS'));
INSERT INTO venta VALUES (DEFAULT, 1, 2500, TO_TIMESTAMP('2024-03-19 10:00:00','YYYY-MM-DD HH24:MI:SS'));
INSERT INTO venta VALUES (DEFAULT, 1, 2500, TO_TIMESTAMP('2024-03-19 15:51:00','YYYY-MM-DD HH24:MI:SS'));
INSERT INTO venta VALUES (DEFAULT, 1, 3200, TO_TIMESTAMP('2024-03-20 14:13:00','YYYY-MM-DD HH24:MI:SS'));
INSERT INTO venta VALUES (DEFAULT, 1, 3200, TO_TIMESTAMP('2024-03-20 16:48:00','YYYY-MM-DD HH24:MI:SS'));
        
INSERT INTO producto VALUES (DEFAULT, 'correa con collar gato', 'correa confortable para gato incluye correa', 5000, 30);
INSERT INTO venta VALUES (DEFAULT, 2, 10000, TO_TIMESTAMP('2023-11-15 00:00:00','YYYY-MM-DD HH24:MI:SS'));
INSERT INTO venta VALUES (DEFAULT, 2, 12000, TO_TIMESTAMP('2023-12-20 00:00:00','YYYY-MM-DD HH24:MI:SS'));
INSERT INTO venta VALUES (DEFAULT, 2, 11500, TO_TIMESTAMP('2024-01-06 00:00:00','YYYY-MM-DD HH24:MI:SS'));
INSERT INTO venta VALUES (DEFAULT, 2, 10500, TO_TIMESTAMP('2024-01-18 00:00:00','YYYY-MM-DD HH24:MI:SS'));
INSERT INTO venta VALUES (DEFAULT, 2, 9000, TO_TIMESTAMP('2024-02-05 00:00:00','YYYY-MM-DD HH24:MI:SS'));

INSERT INTO producto VALUES (DEFAULT, 'canil para perro mediano', 'canil para perro, soporta 30 kg', 40000, 12);
INSERT INTO venta VALUES (DEFAULT, 3, 70000, TO_TIMESTAMP('2023-12-17 00:00:00','YYYY-MM-DD HH24:MI:SS'));
INSERT INTO venta VALUES (DEFAULT, 3, 85000, TO_TIMESTAMP('2024-01-04 00:00:00','YYYY-MM-DD HH24:MI:SS'));
INSERT INTO venta VALUES (DEFAULT, 3, 85000, TO_TIMESTAMP('2024-01-26 00:00:00','YYYY-MM-DD HH24:MI:SS'));
INSERT INTO venta VALUES (DEFAULT, 3, 78000, TO_TIMESTAMP('2024-02-24 00:00:00','YYYY-MM-DD HH24:MI:SS'));
INSERT INTO venta VALUES (DEFAULT, 3, 80000, TO_TIMESTAMP('2024-03-10 00:00:00','YYYY-MM-DD HH24:MI:SS'));

INSERT INTO producto VALUES (DEFAULT, 'casa de perro', 'casa plastica de perro raza peque√±a', 30000, 8);
INSERT INTO venta VALUES (DEFAULT, 4, 75000, TO_TIMESTAMP('2023-11-23 00:00:00','YYYY-MM-DD HH24:MI:SS'));
INSERT INTO venta VALUES (DEFAULT, 4, 70500, TO_TIMESTAMP('2023-11-12 00:00:00','YYYY-MM-DD HH24:MI:SS'));
INSERT INTO venta VALUES (DEFAULT, 4, 55000, TO_TIMESTAMP('2023-12-09 00:00:00','YYYY-MM-DD HH24:MI:SS'));
INSERT INTO venta VALUES (DEFAULT, 4, 80000, TO_TIMESTAMP('2024-02-28 00:00:00','YYYY-MM-DD HH24:MI:SS'));
INSERT INTO venta VALUES (DEFAULT, 4, 85000, TO_TIMESTAMP('2024-02-02 00:00:00','YYYY-MM-DD HH24:MI:SS'));

COMMIT;
